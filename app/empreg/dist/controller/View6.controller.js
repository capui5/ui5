sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/library","sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/core/routing/History"],function(e,t,o,n,s){"use strict";var a=t.URLHelper;return e.extend("empreg.controller.View6",{onInit:function(){this.oList=this.byId("employeelist");this.oDataModel=this.getOwnerComponent().getModel();this.getView().setModel(this.oDataModel);var e=this.getOwnerComponent().getRouter();e.getRoute("View6").attachPatternMatched(this._onRouteMatched,this)},onNavBack:function(){var e,t;e=s.getInstance();t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("List",{},true)}},_onRouteMatched:function(e){var t=e.getParameters();var o=t.arguments.SEmployeeId;var n=this.getView();n.bindElement({path:"/Employees/"+o,model:"MainModel"})},handleEmailPress:function(e){var t="recipient@example.com";var o="Info Request";var n="Hello, I would like to request some information.";var s="mailto:"+t+"?subject="+encodeURIComponent(o)+"&body="+encodeURIComponent(n);window.location.href=s},onDelete:function(){var e=this.getView();var t=e.byId("employeePanel");var o=e.byId("employeelist");if(t){var n=t.getBindingContext("MainModel");sap.m.MessageBox.confirm("Are you sure you want to delete this employee?",{title:"Confirm Deletion",onClose:function(e){if(e===sap.m.MessageBox.Action.OK){n.delete("$direct").then(function(){sap.m.MessageBox.success("Employee deleted successfully.",{onClose:function(){window.location.href="/empreg/webapp/index.html#/Employee-List";setTimeout(function(){window.location.reload()},10)}})}).catch(function(e){sap.m.MessageBox.error("Error deleting employee.")})}}})}},formatPhoto:function(e){if(e){var t=jQuery.sap.getModulePath("empreg","/images/")+e+".jpg";return t}else{return jQuery.sap.getModulePath("empreg","/images/default_image.jpg")}},onEdit:function(){var e=this.getView();if(!this.byId("editDialog")){n.load({id:e.getId(),name:"empreg.view.Edit",controller:this}).then(function(t){e.addDependent(t);var o=e.getModel("MainModel");var n="/Employees";var s=o.createBindingContext(n);var a=t.getContent();var i=a[0];i.setBindingContext(s);t.open()})}else{this.byId("editDialog").open()}},setEmployeeData:function(e){var t=this.getView();t.byId("Id").setValue(e.ID).setEditable(false);t.byId("fname").setValue(e.fname);t.byId("lname").setValue(e.lname);t.byId("desig").setValue(e.desig);t.byId("email").setValue(e.email);t.byId("skills").setValue(e.skills);t.byId("country").setSelectedKey(e.country_ID);t.byId("idstate").setValue(e.State);t.byId("idcity").setValue(e.city);t.byId("myDatePicker").setValue(e.doj);t.byId("yoe").setValue(e.yoe);t.byId("reportingPerson").setValue(e.reportingPerson);t.byId("Phno").setValue(e.Phno);var o=t.byId("genderRadioGroup");var n=e.gender.toLowerCase();if(n==="male"){o.setSelectedIndex(0)}else if(n==="female"){o.setSelectedIndex(1)}var s=t.byId("leave");s.setSelectedKey(e.leave)},onUpdate:function(){const e=this.getView();const t=e.byId("country").getSelectedItem().getKey();const o={Netherlands:1,India:2,Singapore:3};const n=o[t];const s=e.byId("leave").getSelectedKey()==="true";const a=e.byId("Id").getValue();if(!/^\d+$/.test(a)){this.showErrorMessage("Invalid Employee ID. Please enter a valid number.");return}const i=d(e.byId("myDatePicker").getDateValue());const r=parseInt(e.byId("yoe").getValue());const l={ID:parseInt(a),fname:e.byId("fname").getValue(),lname:e.byId("lname").getValue(),desig:e.byId("desig").getValue(),email:e.byId("email").getValue(),skills:e.byId("skills").getValue(),country_ID:n,State:e.byId("idstate").getValue(),city:e.byId("idcity").getValue(),doj:i,yoe:r,reportingPerson:e.byId("reportingPerson").getValue(),gender:e.byId("genderRadioGroup").getSelectedButton().getText(),leave:s};fetch(`./CatalogService/Employees(${l.ID})`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(e=>{if(e.ok){this.showSuccessMessage("Employee data updated successfully!");window.location.reload()}else{throw new Error("Error updating employee data")}}).catch(e=>{this.showErrorMessage(e.message)});function d(e){const t=e.getFullYear();const o=String(e.getMonth()+1).padStart(2,"0");const n=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${n}`}},showSuccessMessage:function(e){const t=this.getView();const o=new sap.m.Dialog({title:"Success",type:"Message",state:"Success",content:new sap.m.Text({text:e}),beginButton:new sap.m.Button({text:"OK",press:function(){o.close()}}),afterClose:function(){o.destroy()}});o.open()},showErrorMessage:function(e){const t=this.getView();const o=new sap.m.Dialog({title:"Error",type:"Message",state:"Error",content:new sap.m.Text({text:e}),beginButton:new sap.m.Button({text:"OK",press:function(){o.close()}}),afterClose:function(){o.destroy()}});o.open()},onCancel:function(e){this.byId("openDialog").close()}})});